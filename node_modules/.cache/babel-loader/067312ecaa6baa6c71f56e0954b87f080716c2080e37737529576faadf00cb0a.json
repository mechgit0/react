{"ast":null,"code":"'use strict';\n\nconst {\n  TDigest\n} = require('tdigest');\nclass TimeWindowQuantiles {\n  constructor(maxAgeSeconds, ageBuckets) {\n    this.maxAgeSeconds = maxAgeSeconds || 0;\n    this.ageBuckets = ageBuckets || 0;\n    this.shouldRotate = maxAgeSeconds && ageBuckets;\n    this.ringBuffer = Array(ageBuckets).fill(new TDigest());\n    this.currentBuffer = 0;\n    this.lastRotateTimestampMillis = Date.now();\n    this.durationBetweenRotatesMillis = maxAgeSeconds * 1000 / ageBuckets || Infinity;\n  }\n  size() {\n    const bucket = rotate.call(this);\n    return bucket.size();\n  }\n  percentile(quantile) {\n    const bucket = rotate.call(this);\n    return bucket.percentile(quantile);\n  }\n  push(value) {\n    rotate.call(this);\n    this.ringBuffer.forEach(bucket => {\n      bucket.push(value);\n    });\n  }\n  reset() {\n    this.ringBuffer.forEach(bucket => {\n      bucket.reset();\n    });\n  }\n  compress() {\n    this.ringBuffer.forEach(bucket => {\n      bucket.compress();\n    });\n  }\n}\nfunction rotate() {\n  let timeSinceLastRotateMillis = Date.now() - this.lastRotateTimestampMillis;\n  while (timeSinceLastRotateMillis > this.durationBetweenRotatesMillis && this.shouldRotate) {\n    this.ringBuffer[this.currentBuffer] = new TDigest();\n    if (++this.currentBuffer >= this.ringBuffer.length) {\n      this.currentBuffer = 0;\n    }\n    timeSinceLastRotateMillis -= this.durationBetweenRotatesMillis;\n    this.lastRotateTimestampMillis += this.durationBetweenRotatesMillis;\n  }\n  return this.ringBuffer[this.currentBuffer];\n}\nmodule.exports = TimeWindowQuantiles;","map":{"version":3,"names":["TDigest","require","TimeWindowQuantiles","constructor","maxAgeSeconds","ageBuckets","shouldRotate","ringBuffer","Array","fill","currentBuffer","lastRotateTimestampMillis","Date","now","durationBetweenRotatesMillis","Infinity","size","bucket","rotate","call","percentile","quantile","push","value","forEach","reset","compress","timeSinceLastRotateMillis","length","module","exports"],"sources":["/home/ashish/my-react-app/node_modules/prom-client/lib/timeWindowQuantiles.js"],"sourcesContent":["'use strict';\n\nconst { TDigest } = require('tdigest');\n\nclass TimeWindowQuantiles {\n\tconstructor(maxAgeSeconds, ageBuckets) {\n\t\tthis.maxAgeSeconds = maxAgeSeconds || 0;\n\t\tthis.ageBuckets = ageBuckets || 0;\n\n\t\tthis.shouldRotate = maxAgeSeconds && ageBuckets;\n\n\t\tthis.ringBuffer = Array(ageBuckets).fill(new TDigest());\n\t\tthis.currentBuffer = 0;\n\n\t\tthis.lastRotateTimestampMillis = Date.now();\n\t\tthis.durationBetweenRotatesMillis =\n\t\t\t(maxAgeSeconds * 1000) / ageBuckets || Infinity;\n\t}\n\n\tsize() {\n\t\tconst bucket = rotate.call(this);\n\t\treturn bucket.size();\n\t}\n\n\tpercentile(quantile) {\n\t\tconst bucket = rotate.call(this);\n\t\treturn bucket.percentile(quantile);\n\t}\n\n\tpush(value) {\n\t\trotate.call(this);\n\t\tthis.ringBuffer.forEach(bucket => {\n\t\t\tbucket.push(value);\n\t\t});\n\t}\n\n\treset() {\n\t\tthis.ringBuffer.forEach(bucket => {\n\t\t\tbucket.reset();\n\t\t});\n\t}\n\n\tcompress() {\n\t\tthis.ringBuffer.forEach(bucket => {\n\t\t\tbucket.compress();\n\t\t});\n\t}\n}\n\nfunction rotate() {\n\tlet timeSinceLastRotateMillis = Date.now() - this.lastRotateTimestampMillis;\n\twhile (\n\t\ttimeSinceLastRotateMillis > this.durationBetweenRotatesMillis &&\n\t\tthis.shouldRotate\n\t) {\n\t\tthis.ringBuffer[this.currentBuffer] = new TDigest();\n\n\t\tif (++this.currentBuffer >= this.ringBuffer.length) {\n\t\t\tthis.currentBuffer = 0;\n\t\t}\n\t\ttimeSinceLastRotateMillis -= this.durationBetweenRotatesMillis;\n\t\tthis.lastRotateTimestampMillis += this.durationBetweenRotatesMillis;\n\t}\n\treturn this.ringBuffer[this.currentBuffer];\n}\n\nmodule.exports = TimeWindowQuantiles;\n"],"mappings":"AAAA,YAAY;;AAEZ,MAAM;EAAEA;AAAQ,CAAC,GAAGC,OAAO,CAAC,SAAS,CAAC;AAEtC,MAAMC,mBAAmB,CAAC;EACzBC,WAAWA,CAACC,aAAa,EAAEC,UAAU,EAAE;IACtC,IAAI,CAACD,aAAa,GAAGA,aAAa,IAAI,CAAC;IACvC,IAAI,CAACC,UAAU,GAAGA,UAAU,IAAI,CAAC;IAEjC,IAAI,CAACC,YAAY,GAAGF,aAAa,IAAIC,UAAU;IAE/C,IAAI,CAACE,UAAU,GAAGC,KAAK,CAACH,UAAU,CAAC,CAACI,IAAI,CAAC,IAAIT,OAAO,CAAC,CAAC,CAAC;IACvD,IAAI,CAACU,aAAa,GAAG,CAAC;IAEtB,IAAI,CAACC,yBAAyB,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;IAC3C,IAAI,CAACC,4BAA4B,GAC/BV,aAAa,GAAG,IAAI,GAAIC,UAAU,IAAIU,QAAQ;EACjD;EAEAC,IAAIA,CAAA,EAAG;IACN,MAAMC,MAAM,GAAGC,MAAM,CAACC,IAAI,CAAC,IAAI,CAAC;IAChC,OAAOF,MAAM,CAACD,IAAI,CAAC,CAAC;EACrB;EAEAI,UAAUA,CAACC,QAAQ,EAAE;IACpB,MAAMJ,MAAM,GAAGC,MAAM,CAACC,IAAI,CAAC,IAAI,CAAC;IAChC,OAAOF,MAAM,CAACG,UAAU,CAACC,QAAQ,CAAC;EACnC;EAEAC,IAAIA,CAACC,KAAK,EAAE;IACXL,MAAM,CAACC,IAAI,CAAC,IAAI,CAAC;IACjB,IAAI,CAACZ,UAAU,CAACiB,OAAO,CAACP,MAAM,IAAI;MACjCA,MAAM,CAACK,IAAI,CAACC,KAAK,CAAC;IACnB,CAAC,CAAC;EACH;EAEAE,KAAKA,CAAA,EAAG;IACP,IAAI,CAAClB,UAAU,CAACiB,OAAO,CAACP,MAAM,IAAI;MACjCA,MAAM,CAACQ,KAAK,CAAC,CAAC;IACf,CAAC,CAAC;EACH;EAEAC,QAAQA,CAAA,EAAG;IACV,IAAI,CAACnB,UAAU,CAACiB,OAAO,CAACP,MAAM,IAAI;MACjCA,MAAM,CAACS,QAAQ,CAAC,CAAC;IAClB,CAAC,CAAC;EACH;AACD;AAEA,SAASR,MAAMA,CAAA,EAAG;EACjB,IAAIS,yBAAyB,GAAGf,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,IAAI,CAACF,yBAAyB;EAC3E,OACCgB,yBAAyB,GAAG,IAAI,CAACb,4BAA4B,IAC7D,IAAI,CAACR,YAAY,EAChB;IACD,IAAI,CAACC,UAAU,CAAC,IAAI,CAACG,aAAa,CAAC,GAAG,IAAIV,OAAO,CAAC,CAAC;IAEnD,IAAI,EAAE,IAAI,CAACU,aAAa,IAAI,IAAI,CAACH,UAAU,CAACqB,MAAM,EAAE;MACnD,IAAI,CAAClB,aAAa,GAAG,CAAC;IACvB;IACAiB,yBAAyB,IAAI,IAAI,CAACb,4BAA4B;IAC9D,IAAI,CAACH,yBAAyB,IAAI,IAAI,CAACG,4BAA4B;EACpE;EACA,OAAO,IAAI,CAACP,UAAU,CAAC,IAAI,CAACG,aAAa,CAAC;AAC3C;AAEAmB,MAAM,CAACC,OAAO,GAAG5B,mBAAmB","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}